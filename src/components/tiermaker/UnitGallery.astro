---
import type { UnitData } from "../../types/unit.types";

interface Props {
    units: UnitData[];
    apiBchaico: string;
}

const { units, apiBchaico } = Astro.props;
---

<section id="unit-gallery">
    <h3>Unidades Disponibles</h3>
    <div id="pool-container" class="drop-zone">
        {
            units.map((unit, index) => {
                const colors = unit.color.content.map((c) => c.id).join(",");
                const tags = unit.tags.content.map((t) => t.id).join(",");
                const names =
                    unit.name.count > 1
                        ? unit.name.content.join(",")
                        : unit.name.content[0];
                return (
                    <a
                        class="unit-card"
                        draggable="true"
                        data-id={unit._id}
                        data-num={unit.num}
                        data-index={index}
                        data-name={names}
                        data-color={colors}
                        data-tag={tags}
                        data-chapter={unit.chapter.id}
                        data-rarity={unit.rarity.id}
                        data-type={unit.type.id}
                        data-zenkai={unit.zenkai}
                    >
                        <img
                            src={`${apiBchaico}${unit.num}.webp`}
                            alt={`image of ${unit._id}`}
                            loading="lazy"
                            draggable="false"
                        />
                    </a>
                );
            })
        }
    </div>
</section>

<style is:global>
    #unit-gallery {
        z-index: 1;

        & h3 {
            color: #eee;
            margin-bottom: 0.5rem;
        }

        & #pool-container {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.25rem;
            padding: 1rem 0.5rem;
            justify-content: center;
            transition: all 0.2s ease;
            border: 2px dashed transparent;

            &.drag-over {
                background-color: rgba(253, 208, 23, 0.1);
                border-color: var(--color-highlight);
            }
        }
    }

    .unit-card {
        cursor: grab;
        width: 80px;
        height: 80px;
        display: block;
        transition: transform 0.1s ease;
        position: relative;
        border-radius: 4px;
        overflow: hidden;

        & img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        &.dragging {
            opacity: 0.2;
            transform: scale(0.9);
        }

        &.filtered {
            display: none !important;
        }

        &.drop-animation {
            animation: popIn 0.2s ease-out;
        }
    }

    @keyframes popIn {
        0% {
            transform: scale(0.8);
        }
        100% {
            transform: scale(1);
        }
    }
</style>
